<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>Tablero de Tareas</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="shortcut icon"
      href="favicon.ico"
      type="image/x-icon"
    />
    <style>
      .column-wrapper {
        min-height: 80vh;
        height: 100%;
      }
    </style>
  </head>
  <body
    class="bg-light"
    id="body"
  >
    <main class="container px-5 px-lg-0 py-4">
      <h1 class="text-center mb-5 fs-2">Gesti√≥n de Tareas</h1>
      <div class="row g-4">
        <!-- PENDIENTES -->
        <div class="col-lg-4">
          <div
            id="pendientes"
            class="column-wrapper bg-white rounded-2 p-3 shadow border-top border-warning border-4"
          >
            <h3 class="fs-4 mb-4 d-flex justify-content-between">
              Pendientes <span class="badge bg-secondary">0</span>
            </h3>
          </div>
        </div>
        <!-- EN PROCESO -->
        <div class="col-lg-4">
          <div
            id="en-proceso"
            class="column-wrapper bg-white rounded-2 p-3 shadow border-top border-primary border-4"
          >
            <h3 class="fs-4 mb-4 d-flex justify-content-between">
              En proceso <span class="badge bg-secondary">0</span>
            </h3>
          </div>
        </div>
        <!-- FINALIZADAS -->
        <div class="col-lg-4">
          <div
            id="finalizadas"
            class="column-wrapper bg-white rounded-2 p-3 shadow border-top border-success border-4"
          >
            <h3 class="fs-4 mb-4 d-flex justify-content-between">
              Finalizadas <span class="badge bg-secondary">0</span>
            </h3>
          </div>
        </div>
      </div>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="main.js"></script>
    <script>
      const obtenerColorBadge = (texto) => {
        if (texto.includes('A tiempo')) return 'bg-success';
        if (texto.includes('Atrasada')) return 'bg-danger';
        if (texto.includes('Vence pronto')) return 'bg-info text-dark';
        if (texto.includes('Vence hoy')) return 'bg-warning text-dark';
        if (texto === '') return 'bg-secondary';
      };

      const agregarTarjeta = (contenedor, tarea) => {
        const {
          titulo,
          categoria,
          estado,
          vigencia,
          fecha_creacion,
          fecha_vencimiento,
        } = tarea;
        const card = document.createElement('div');
        card.className = 'card mb-3 shadow-sm';

        const cardBody = document.createElement('div');
        const muted = estado === 'Finalizada' ? 'text-muted' : '';
        cardBody.className = `card-body ${muted}`;

        const cardTitle = document.createElement('h3');
        const tachado =
          estado === 'Finalizada' ? 'text-decoration-line-through' : '';
        cardTitle.className = `card-title fs-5 ${tachado}`;
        cardTitle.innerText = titulo;

        const cardSubtitle = document.createElement('p');
        cardSubtitle.className =
          'card-subtitle mb-2 text-muted small fw-medium';
        cardSubtitle.innerText = categoria;

        const cardDate = document.createElement('span');
        cardDate.className = 'small d-block text-muted';
        cardDate.innerText = `üìÖ ${fecha_creacion} - ${fecha_vencimiento || 'Sin fecha de t√©rmino'}`;

        const cardBadge = document.createElement('span');
        cardBadge.className = `badge ${obtenerColorBadge(vigencia)}`;
        const textoVigencia =
          vigencia !== ''
            ? vigencia.replace(/\[.*?\]/g, '')
            : estado === 'Finalizada'
              ? 'Completado'
              : 'Sin tiempo l√≠mite';
        cardBadge.innerText = textoVigencia;

        cardBody.appendChild(cardTitle);
        cardBody.appendChild(cardSubtitle);
        cardBody.appendChild(cardDate);
        cardBody.appendChild(cardBadge);
        card.appendChild(cardBody);
        contenedor.appendChild(card);
      };

      const pendientesCont = document.getElementById('pendientes');
      const enProcesoCont = document.getElementById('en-proceso');
      const finalizadasCont = document.getElementById('finalizadas');

      const contadores = {
        pendiente: 0,
        proceso: 0,
        finalizada: 0,
      };

      tareas.forEach((tarea) => {
        if (tarea.estado === 'Pendiente') {
          agregarTarjeta(pendientesCont, tarea);
          contadores.pendiente += 1;
        }
        if (tarea.estado === 'En proceso') {
          agregarTarjeta(enProcesoCont, tarea);
          contadores.proceso += 1;
        }
        if (tarea.estado === 'Finalizada') {
          agregarTarjeta(finalizadasCont, tarea);
          contadores.finalizada += 1;
        }
      });

      pendientesCont.querySelector('h3 span').innerText = contadores.pendiente;
      enProcesoCont.querySelector('h3 span').innerText = contadores.proceso;
      finalizadasCont.querySelector('h3 span').innerText =
        contadores.finalizada;
    </script>
  </body>
</html>
